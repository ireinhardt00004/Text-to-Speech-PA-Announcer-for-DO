<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text To Speech PA Announcer</title>
<link rel="shortcut icon" href="assets/background-test.avif" type="image/x-icon">
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background-color: black;
  padding: 30px;
  display: flex;
  justify-content: center;
  position: relative;
  z-index: 0; 
}
body::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('assets/background-test.avif');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  opacity: 0.3; 
  z-index: -1; 
}
/* Date & Time */
.datetime {
  display: flex;
  justify-content: space-between;
  color: #1e293b;
  font-weight: bold;
  font-size: 14px;
  margin-bottom: 10px;
}
.card {
  background: #fff;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 1000px; 
  border: 1px solid black;
  box-sizing: border-box;
}

h2 { text-align:center; margin-bottom:20px; color:#333; }
textarea { width:100%; min-height:140px; padding:10px; font-size:15px; border:1px solid #ccc; border-radius:8px; margin-bottom:15px; resize:none; }
label { font-weight:bold; display:block; margin-top:10px; margin-bottom:5px; color:#444; }
input, select { width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:16px; }
button { padding:10px 20px; border:none; border-radius:8px; margin:5px; cursor:pointer; font-size:15px; font-weight:bold; transition:all 0.2s ease-in-out; }
button.speak { background:#2563eb; color:white; font-size:20px; width:45%; max-width:200px; }
button.stop { background:#dc2626; color:white; font-size:20px; width:45%; max-width:200px; }
button.update-btn { background:#10b981; color:white; font-weight:bold; padding:12px 18px; }
button.speak:hover { background:#1d4ed8; }
button.stop:hover { background:#b91c1c; }
button.update-btn:hover { background:#059669; }

#voices { border:2px solid #2563eb; background:#eef2ff; }

@media (max-width: 1024px) {
  .card { max-width: 90%; padding: 20px; }
}

@media (max-width: 600px) {
  .card { max-width: 95%; padding: 15px; }
}
.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 10px;
  border-radius: 5px;
  background-color: #4158D0;
  background-image: linear-gradient(43deg, #4158D0 0%, #C850C0 46%, #FFCC70 100%);
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}
.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: #4c00ff;
  background-image: linear-gradient(160deg, #4900f5 0%, #80D0C7 100%);
  cursor: pointer;
}
.slider::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: #0093E9;
  background-image: linear-gradient(160deg, #0093E9 0%, #80D0C7 100%);
  cursor: pointer;
}
/* Speaker Animation */
.speaker {
  font-size: 40px;
  text-align: center;
  margin-top: 10px;
  color: #2563eb;
  animation: pulse 1s infinite;
}
.hidden { display: none; }
@keyframes pulse {
  0% { transform: scale(1); opacity: 0.7; }
  50% { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); opacity: 0.7; }
}

/* Section Boxes */
.section-box {
  border: 2px solid #2563eb;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 25px;
  background: #f9fafb;
  position: relative;
}
.section-title {
  position: absolute;
  top: -14px;
  left: 20px;
  background: white;
  padding: 0 12px;
  font-weight: bold;
  color: #2563eb;
  font-size: 16px;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Vehicle Info Layout */
.vehicle-info {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 20px;
}
.vehicle-info .form-control { margin: 10px; }

@media (max-width: 768px) {
  .vehicle-info { grid-template-columns: 1fr; gap: 15px; }
}
</style>
</head>
<body>
<div class="card">
  <div class="datetime d-flex gap-3">
    <span id="live-time"></span>
    <span id="live-date"></span>
  </div>
  <h2>üì¢ Text To Speech PA Announcer</h2>

  <!-- Vehicle Information Section -->
  <div class="section-box">
    <div class="section-title">üöó Vehicle Information</div>
    <div class="vehicle-info">
      <div class="form-control">
        <label for="carModel">Vehicle Model:</label>
        <input type="text" id="carModel" placeholder="e.g., tricycle, Toyota, Mitsubishi etc..">
      </div>
      <div class="form-control">
        <label for="carColor">Vehicle Color:</label>
        <input type="text" id="carColor" placeholder="e.g., red, black, orange etc..">
      </div>
      <div class="form-control">
        <label for="plateNumber">Plate Number:</label>
        <input type="text" id="plateNumber" placeholder="e.g., DAP123, KYS123 etc..">
      </div>
    </div>
    <center>
      <button onclick="updateText()" class="update-btn">Update the Announcement Text</button>
    </center>
  </div>

  <!-- Announcement Text Section -->
  <div class="section-box">
    <div class="section-title">üìù Customized Announcement Text</div>
    <div class="form-control">
      <textarea id="text" style="font-size:20px;">Magandang Araw po sa lahat, para po sa may-ari ng sasakyan na pulang tricycle na may PLATE NUMBER po na DAP123 mangyari po lamang na pakilipat ang inyong parking. Maraming Salamat po.
      </textarea>
    </div>
  </div>

  <!-- Voice Settings Section -->
  <div class="section-box">
    <div class="section-title">üé§ Voice Settings</div>
    <div class="form-control">
      <label for="voices"><span style="color:red;">*</span> Choose Voice:</label>
      <select id="voices"></select>
    </div>
    <div class="form-control">
      <label for="rate">Adjust Speed:</label>
      <input type="range" class="slider" id="rate" min="0.5" max="2" step="0.1" value="1">
      <center><span id="rateValue">1</span></center>
    </div>
    <div class="form-control">
      <label for="pitch">Adjust Pitch:</label>
      <input type="range" class="slider" id="pitch" min="0" max="2" step="0.1" value="1">
      <center><span id="pitchValue">1</span></center>
    </div>
    <center>
      <button onclick="speak()" class="speak">‚ñ∂Ô∏è Speak</button>
      <button onclick="stop()" class="stop">‚èπ Stop</button>
    </center>
    <div id="speaker-icon" class="speaker hidden">üîä Speaking...</div>
  </div>

  <audio id="chime" src="assets/chime.mp3" preload="auto"></audio>
  <audio id="reverse-chime" src="assets/reverse-chime.mp3" preload="auto"></audio>
  <div class="form-control">
    <em>Developed for: SDO Cavite Province &copy; 2025</em>
  </div>
</div>

<script>
const synth = window.speechSynthesis;
const voiceSelect = document.getElementById("voices");
const rateInput = document.getElementById("rate");
const pitchInput = document.getElementById("pitch");
const chime = document.getElementById("chime");
const reversechime = document.getElementById("reverse-chime");
const speakerIcon = document.getElementById("speaker-icon");

// Load voices
function loadVoices() {
  const allVoices = synth.getVoices();
  const filtered = allVoices.filter(v => v.lang.startsWith("en") || v.lang.startsWith("fil"));
  voiceSelect.innerHTML = "";
  filtered.forEach(v => {
    const option = document.createElement("option");
    option.value = v.name;
    option.textContent = `${v.name} (${v.lang})`;
    voiceSelect.appendChild(option);
  });
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// Stop speech
function stop() {
  if (synth.speaking) synth.cancel();
  speakerIcon.classList.add("hidden");
}

// Update announcement text
function updateText() {
  const model = document.getElementById("carModel").value.trim() || "sasakyan";
  const color = document.getElementById("carColor").value.trim() || "";
  const plate = document.getElementById("plateNumber").value.trim().toUpperCase() || "XXXX";
  document.getElementById("text").value =
    `Magandang Araw po sa lahat, para po sa may-ari ng ${color} ${model} na may PLATE NUMBER po na ${plate} mangyari po lamang na pakilipat ang inyong parking. Maraming Salamat po.`;
}

// Speak plate properly
function speakPlate(plate, voice, rate, pitch, callback){
  const numbers = ["zero","one","two","three","four","five","six","seven","eight","nine"];
  const letters = {
    A:"ay",B:"bee",C:"cee",D:"dee",E:"ee",F:"ef",G:"gee",H:"aych",I:"eye",
    J:"jay",K:"kay",L:"el",M:"em",N:"en",O:"oh",P:"pee",Q:"cue",R:"ar",S:"es",T:"tee",
    U:"you",V:"vee",W:"double you",X:"ex",Y:"why",Z:"zee"
  };
  const chars = plate.replace(/\s+/g,"").split("");
  let spoken = chars.map(c=>{
    if(/[A-Z]/.test(c)) return letters[c] || c;
    if(/[0-9]/.test(c)) return numbers[parseInt(c)];
    return "";
  }).join(" ");
  const utter = new SpeechSynthesisUtterance(spoken);
  utter.voice = voice;
  utter.rate = rate;
  utter.pitch = pitch;
  utter.onend = ()=>{ if(callback) callback(); };
  synth.speak(utter);
}

function speak(){
  if(synth.speaking) synth.cancel();
  speakerIcon.classList.remove("hidden");

  const text = document.getElementById("text").value;
  const voices = synth.getVoices();
  const selectedVoice = voices.find(v=>v.name===voiceSelect.value);
  const rate = parseFloat(rateInput.value);
  const pitch = parseFloat(pitchInput.value);

  const plateRegex = /\b([A-Z]{1,4}[0-9]{1,4})\b/g;
  const match = plateRegex.exec(text);

  chime.currentTime=0;
  chime.play().then(()=>{
    chime.onended = ()=>{
      let repeatCount = 0;
      const playAnnouncement = ()=>{
        if(match){
          const before = text.substring(0, match.index).trim();
          const after = text.substring(match.index + match[0].length).trim();
          const speakAfter = ()=>{
            if(after){
              const utterAfter = new SpeechSynthesisUtterance(after);
              utterAfter.voice = selectedVoice;
              utterAfter.rate = rate;
              utterAfter.pitch = pitch;
              utterAfter.onend = ()=>{
                repeatCount++;
                if(repeatCount < 2) playAnnouncement();
                else { reversechime.currentTime=0; reversechime.play(); speakerIcon.classList.add("hidden"); }
              };
              synth.speak(utterAfter);
            } else {
              repeatCount++;
              if(repeatCount < 2) playAnnouncement();
              else { reversechime.currentTime=0; reversechime.play(); speakerIcon.classList.add("hidden"); }
            }
          };
          if(before){
            const utterBefore = new SpeechSynthesisUtterance(before);
            utterBefore.voice = selectedVoice;
            utterBefore.rate = rate;
            utterBefore.pitch = pitch;
            utterBefore.onend = ()=>{ speakPlate(match[0], selectedVoice, rate, pitch, speakAfter); };
            synth.speak(utterBefore);
          } else {
            speakPlate(match[0], selectedVoice, rate, pitch, speakAfter);
          }
        } else {
          const utter = new SpeechSynthesisUtterance(text);
          utter.voice = selectedVoice;
          utter.rate = rate;
          utter.pitch = pitch;
          utter.onend = ()=>{
            repeatCount++;
            if(repeatCount < 2) playAnnouncement();
            else { reversechime.currentTime=0; reversechime.play(); speakerIcon.classList.add("hidden"); }
          };
          synth.speak(utter);
        }
      };
      playAnnouncement();
    };
  });
}

// Update sliders
rateInput.oninput = ()=>document.getElementById("rateValue").textContent=rateInput.value;
pitchInput.oninput = ()=>document.getElementById("pitchValue").textContent=pitchInput.value;
</script>

<!-- date-time -->
<script>
const timeEl = document.getElementById('live-time');
const dateEl = document.getElementById('live-date');
function updateDateTime() {
  const now = new Date();
  timeEl.textContent = now.toLocaleTimeString();
  dateEl.textContent = now.toLocaleDateString(undefined, {
    weekday: 'short',
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
}
updateDateTime();
setInterval(updateDateTime, 1000);
</script>

</body>
</html>
